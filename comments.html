<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Comment List</title>
        <link rel="stylesheet" href="./css/style.css" />
    </head>
    <body>
        <div id="root">
            <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
            <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
            <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
            <script type="text/babel">
                function CommentList() {
                    const [comments, setComments] = React.useState([]);
                    const [comment, setComment] = React.useState([]);
                    const [loading, setLoading] = React.useState(false);
                    const getComments = async () => {
                        try {
                            setLoading(true);
                            const response = await fetch("https://jsonplaceholder.typicode.com/comments?postId=1");
                            if (!response.ok) {
                                throw new Error(`HTTP error! status: ${response.status}`);
                            }
                            const result = await response.json();
                            console.log(result);
                            setComments(result);
                        } catch (error) {
                            alert(error);
                            setLoading(false);
                        } finally {
                            setLoading(false);
                        }
                    };

                    const handleChange = (e) => {
                        console.log(e.target.value);
                        setComment((prev) => {
                            return { ...prev, [e.target.name]: e.target.value };
                        });
                    };

                    const handleSubmit = (e) => {
                        e.preventDefault();
                        setComments((prev) => {
                            return [comment, ...prev];
                        });
                        setComment({});
                    };
                    React.useEffect(() => {
                        getComments();
                    }, []);

                    return (
                        <>
                            <a href="/" class="btn-back">
                                ⬅ Back
                            </a>
                            <h1 class="heading">Comment List</h1>
                            {loading == false ? (
                                <div class="comment-wrap">
                                    {comments &&
                                        comments.length > 0 &&
                                        comments.map((comment) => {
                                            return (
                                                <div class="comment-item" key={comment.id}>
                                                    <img
                                                        src={`https://ui-avatars.com/api/?name=${comment.name}`}
                                                        alt=""
                                                        class="comment-img"
                                                    />
                                                    <div class="comment-info">
                                                        <div class="comment-title">{comment.name}</div>
                                                        <div class="comment-email">{comment.email}</div>
                                                        <p class="comment-body">{comment.body}</p>
                                                        <p class="comment-time">1 ngày trước</p>
                                                    </div>
                                                </div>
                                            );
                                        })}

                                    <form class="comment-form" onSubmit={handleSubmit}>
                                        <input
                                            placeholder="Nhập name"
                                            onChange={handleChange}
                                            type="text"
                                            name="name"
                                            value={comment.name || ""}
                                        />
                                        <input
                                            placeholder="Nhập email"
                                            onChange={handleChange}
                                            type="email"
                                            name="email"
                                            value={comment.email || ""}
                                        />
                                        <input
                                            placeholder="Nhập body"
                                            onChange={handleChange}
                                            type="text"
                                            name="body"
                                            value={comment.body || ""}
                                        />
                                        <button class="btn success" type="submit">
                                            Đăng
                                        </button>
                                    </form>
                                </div>
                            ) : (
                                <h3 class="heading">Đang tải....</h3>
                            )}
                        </>
                    );
                }

                const app = <CommentList />;
                const root = ReactDOM.createRoot(document.querySelector("#root"));
                root.render(app);
            </script>
        </div>
    </body>
</html>
