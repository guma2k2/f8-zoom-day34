<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Product List</title>
        <link rel="stylesheet" href="./css/style.css" />
    </head>
    <body>
        <div id="root">
            <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
            <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
            <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
            <script type="text/babel">
                function Modal({ open, setOpen, children }) {
                    console.log(children);
                    return (
                        <div class={`modal-container ${open && "active"}`}>
                            <div class="modal-wrapper">{children}</div>
                            <div class="modal-overlay" onClick={() => setOpen(false)}></div>
                        </div>
                    );
                }

                function ProductList() {
                    const [products, setProducts] = React.useState([]);
                    const [loading, setLoading] = React.useState(false);
                    const [open, setOpen] = React.useState(false);
                    const [productId, setProductId] = React.useState();
                    const getProducts = async () => {
                        try {
                            setLoading(true);
                            const response = await fetch("https://jsonplaceholder.typicode.com/posts?_limit=12");
                            if (!response.ok) {
                                throw new Error(`HTTP error! status: ${response.status}`);
                            }
                            const result = await response.json();
                            console.log(result);
                            setProducts(result);
                        } catch (error) {
                            alert(error);
                            setLoading(false);
                        } finally {
                            setLoading(false);
                        }
                    };

                    const handleOpenModal = (productId) => {
                        setOpen(true);
                        setProductId(productId);
                    };

                    const getProductActive = () => {
                        if (products.length == 0) return null;
                        console.log(productId);
                        return products.find((product) => product.id === productId);
                    };
                    React.useEffect(() => {
                        getProducts();
                    }, []);

                    return (
                        <>
                            <a href="/" class="btn-back">
                                â¬… Back
                            </a>
                            <h1 class="heading">Product List</h1>
                            {!loading ? (
                                <div class="product-wrap">
                                    {products &&
                                        products.length > 0 &&
                                        products.map((product) => {
                                            return (
                                                <div class="product-item" key={product.id}>
                                                    <div class="product-id">{product.id}</div>
                                                    <h2 class="product-title">{product.title}</h2>
                                                    <p class="product-body">{product.body}</p>
                                                    <div class="btn success" onClick={() => handleOpenModal(product.id)}>
                                                        Xem chi tiet
                                                    </div>
                                                </div>
                                            );
                                        })}
                                </div>
                            ) : (
                                <h2>Dang tai....</h2>
                            )}
                            <Modal open={open} setOpen={setOpen}>
                                {getProductActive() ? (
                                    <div key={getProductActive().id}>
                                        <div class="product-id">{getProductActive().id}</div>
                                        <h2 class="product-title">{getProductActive().title}</h2>
                                        <p>{getProductActive().body}</p>
                                    </div>
                                ) : (
                                    <div>Error....</div>
                                )}
                            </Modal>
                        </>
                    );
                }

                const app = <ProductList />;
                const root = ReactDOM.createRoot(document.querySelector("#root"));
                root.render(app);
            </script>
        </div>
    </body>
</html>
